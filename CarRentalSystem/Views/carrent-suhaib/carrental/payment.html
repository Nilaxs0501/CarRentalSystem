<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Payment | Luxury Wheels</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="assests\css\style.css">
<style>
.payment-container {
  padding: 2rem 5%;
  min-height: 100vh;
  max-width: 1000px;
  margin: 0 auto;
}

.payment-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 2rem;
  padding-bottom: 1rem;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.payment-title {
  font-size: 2.2rem;
  color: var(--accent);
}

.payment-steps {
  display: flex;
  justify-content: space-between;
  margin-bottom: 40px;
  position: relative;
}

.payment-steps::before {
  content: "";
  position: absolute;
  top: 20px;
  left: 0;
  right: 0;
  height: 2px;
  background: rgba(255, 255, 255, 0.1);
  z-index: 1;
}

.step {
  display: flex;
  flex-direction: column;
  align-items: center;
  position: relative;
  z-index: 2;
}

.step-number {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.1);
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 10px;
  font-weight: 600;
  transition: var(--transition);
}

.step.active .step-number {
  background: var(--accent);
  color: var(--primary);
}

.step.completed .step-number {
  background: #27ae60;
  color: white;
}

.step-text {
  font-size: 0.9rem;
  color: var(--text-secondary);
}

.step.active .step-text {
  color: var(--accent);
  font-weight: 600;
}

.payment-content {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 40px;
}

.booking-summary {
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(12px);
  padding: 25px;
  border-radius: var(--radius);
  height: fit-content;
}

.booking-summary h3 {
  margin-bottom: 20px;
  color: var(--accent);
  padding-bottom: 10px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.car-detail {
  display: flex;
  gap: 15px;
  margin-bottom: 20px;
}

.car-image {
  width: 100px;
  height: 60px;
  border-radius: var(--radius);
  overflow: hidden;
}

.car-image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.car-info h4 {
  margin-bottom: 5px;
}

.car-info p {
  font-size: 0.9rem;
  color: var(--text-secondary);
}

.booking-details {
  margin-top: 20px;
}

.detail-item {
  display: flex;
  justify-content: space-between;
  margin-bottom: 10px;
  padding-bottom: 10px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.detail-item:last-child {
  border-bottom: none;
}

.detail-item.total {
  font-weight: 700;
  font-size: 1.2rem;
  color: var(--accent);
}

.payment-form {
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(12px);
  padding: 25px;
  border-radius: var(--radius);
}

.payment-form h3 {
  margin-bottom: 20px;
  color: var(--accent);
  padding-bottom: 10px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.form-group {
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  color: var(--text-secondary);
}

.form-group input, .form-group select {
  width: 100%;
  padding: 12px 15px;
  border: none;
  background: rgba(255, 255, 255, 0.05);
  border-radius: var(--radius);
  color: var(--text);
  font-size: 1rem;
  transition: var(--transition);
}

.form-group input:focus, .form-group select:focus {
  outline: none;
  box-shadow: 0 0 0 2px var(--accent);
}

.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 15px;
}

.btn {
  padding: 12px 25px;
  border: none;
  border-radius: var(--radius);
  cursor: pointer;
  transition: var(--transition);
  font-weight: 600;
}

.btn-primary {
  background: var(--accent);
  color: var(--primary);
  width: 100%;
}

.btn-primary:hover {
  transform: translateY(-3px);
  box-shadow: 0 5px 15px rgba(200, 155, 60, 0.4);
}

.btn-secondary {
  background: rgba(255, 255, 255, 0.1);
  color: var(--text);
}

.btn-secondary:hover {
  background: rgba(255, 255, 255, 0.2);
}

.payment-actions {
  display: flex;
  gap: 15px;
  margin-top: 30px;
}

.success-message {
  text-align: center;
  padding: 40px 0;
}

.success-message i {
  font-size: 4rem;
  color: #27ae60;
  margin-bottom: 20px;
}

.success-message h2 {
  margin-bottom: 15px;
  color: var(--accent);
}

.success-message p {
  color: var(--text-secondary);
  margin-bottom: 30px;
}

@media (max-width: 768px) {
  .payment-content {
    grid-template-columns: 1fr;
  }
  
  .payment-steps {
    flex-direction: column;
    gap: 20px;
    align-items: flex-start;
  }
  
  .payment-steps::before {
    display: none;
  }
  
  .step {
    flex-direction: row;
    gap: 15px;
  }
  
  .form-row {
    grid-template-columns: 1fr;
  }
}
</style>
</head>
<body>
<div class="payment-container">
  <div class="payment-header">
    <h1 class="payment-title">Complete Your Booking</h1>
    <button class="btn btn-secondary" onclick="location.href='index.html'">Cancel</button>
  </div>
  
  <div class="payment-steps">
    <div class="step active" id="step1">
      <div class="step-number">1</div>
      <div class="step-text">Booking Details</div>
    </div>
    <div class="step" id="step2">
      <div class="step-number">2</div>
      <div class="step-text">Payment</div>
    </div>
    <div class="step" id="step3">
      <div class="step-number">3</div>
      <div class="step-text">Confirmation</div>
    </div>
  </div>
  
  <div id="bookingDetails" class="payment-content">
    <div class="booking-summary">
      <h3>Booking Summary</h3>
      <div class="car-detail">
        <div class="car-image">
          <img id="summaryCarImage" src="" alt="Car">
        </div>
        <div class="car-info">
          <h4 id="summaryCarName">Car Name</h4>
          <p id="summaryCarSpecs">Specifications</p>
          <p id="summaryCarPrice">Price per day: $0</p>
        </div>
      </div>
      
      <div class="booking-details">
        <div class="detail-item">
          <span>Rental Period:</span>
          <span id="summaryRentalPeriod">0 days</span>
        </div>
        <div class="detail-item">
          <span>Daily Rate:</span>
          <span id="summaryDailyRate">$0</span>
        </div>
        <div class="detail-item">
          <span>Subtotal:</span>
          <span id="summarySubtotal">$0</span>
        </div>
        <div class="detail-item">
          <span>Tax (10%):</span>
          <span id="summaryTax">$0</span>
        </div>
        <div class="detail-item total">
          <span>Total:</span>
          <span id="summaryTotal">$0</span>
        </div>
      </div>
    </div>
    
    <div class="payment-form">
      <h3>Rental Information</h3>
      <form id="bookingForm">
        <div class="form-group">
          <label for="pickupDate">Pickup Date</label>
          <input type="date" id="pickupDate" required>
        </div>
        <div class="form-group">
          <label for="returnDate">Return Date</label>
          <input type="date" id="returnDate" required>
        </div>
        <div class="form-group">
          <label for="pickupLocation">Pickup Location</label>
          <select id="pickupLocation" required>
            <option value="">Select location</option>
            <option value="main">Main Office - 123 Luxury Avenue</option>
            <option value="airport">City Airport</option>
            <option value="downtown">Downtown Branch</option>
          </select>
        </div>
        <div class="form-group">
          <label for="specialRequests">Special Requests</label>
          <input type="text" id="specialRequests" placeholder="Any special requests?">
        </div>
        <button type="button" class="btn btn-primary" onclick="proceedToPayment()">Proceed to Payment</button>
      </form>
    </div>
  </div>
  
  <div id="paymentSection" class="payment-content" style="display: none;">
    <div class="booking-summary">
      <h3>Order Summary</h3>
      <div id="paymentSummary"></div>
    </div>
    
    <div class="payment-form">
      <h3>Payment Details</h3>
      <form id="paymentForm">
        <div class="form-group">
          <label for="cardNumber">Card Number</label>
          <input type="text" id="cardNumber" placeholder="1234 5678 9012 3456" required>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="expiryDate">Expiry Date</label>
            <input type="text" id="expiryDate" placeholder="MM/YY" required>
          </div>
          <div class="form-group">
            <label for="cvv">CVV</label>
            <input type="text" id="cvv" placeholder="123" required>
          </div>
        </div>
        <div class="form-group">
          <label for="cardName">Name on Card</label>
          <input type="text" id="cardName" placeholder="John Doe" required>
        </div>
        <div class="payment-actions">
          <button type="button" class="btn btn-secondary" onclick="backToBooking()">Back</button>
          <button type="button" class="btn btn-primary" onclick="processPayment()">Pay Now</button>
        </div>
      </form>
    </div>
  </div>
  
  <div id="confirmationSection" style="display: none;">
    <div class="success-message">
      <i class="fas fa-check-circle"></i>
      <h2>Booking Confirmed!</h2>
      <p>Thank you for your booking. Your rental has been confirmed.</p>
      <p>Your booking reference: <strong id="bookingReference">LW-123456</strong></p>
      <div class="payment-actions">
        <button class="btn btn-secondary" onclick="location.href='index.html'">Back to Home</button>
        <button class="btn btn-primary" onclick="location.href='user.html'">View My Bookings</button>
      </div>
    </div>
  </div>
</div>

<script src="assets/js/main.js"></script>
<script>
// Check if user is logged in
document.addEventListener("DOMContentLoaded", function() {
  const currentUser = JSON.parse(localStorage.getItem('currentUser'));
  
  if (!currentUser) {
    alert("Please log in to make a booking.");
    window.location.href = "index.html";
    return;
  }
  
  // Check if a car is selected
  const selectedCar = JSON.parse(sessionStorage.getItem('selectedCar'));
  
  if (!selectedCar) {
    alert("No car selected. Redirecting to car selection.");
    window.location.href = "index.html#cars";
    return;
  }
  
  // Initialize booking form
  initializeBookingForm(selectedCar);
});

let bookingData = {
  car: null,
  pickupDate: null,
  returnDate: null,
  pickupLocation: null,
  specialRequests: null,
  totalPrice: 0
};

function initializeBookingForm(car) {
  bookingData.car = car;
  
  // Set minimum date to today
  const today = new Date().toISOString().split('T')[0];
  document.getElementById("pickupDate").min = today;
  document.getElementById("returnDate").min = today;
  
  // Update summary
  document.getElementById("summaryCarImage").src = car.image;
  document.getElementById("summaryCarName").textContent = car.name;
  document.getElementById("summaryCarSpecs").textContent = car.specs.join(" | ");
  document.getElementById("summaryCarPrice").textContent = `Price per day: $${car.price}`;
  document.getElementById("summaryDailyRate").textContent = `$${car.price}`;
  
  // Add event listeners for date changes
  document.getElementById("pickupDate").addEventListener("change", updateSummary);
  document.getElementById("returnDate").addEventListener("change", updateSummary);
}

function updateSummary() {
  const pickupDate = new Date(document.getElementById("pickupDate").value);
  const returnDate = new Date(document.getElementById("returnDate").value);
  
  if (!pickupDate || !returnDate || returnDate <= pickupDate) {
    return;
  }
  
  // Calculate rental days
  const oneDay = 24 * 60 * 60 * 1000; // hours*minutes*seconds*milliseconds
  const rentalDays = Math.round(Math.abs((returnDate - pickupDate) / oneDay));
  
  if (rentalDays < 1) {
    alert("Return date must be after pickup date.");
    return;
  }
  
  // Calculate prices
  const dailyRate = bookingData.car.price;
  const subtotal = dailyRate * rentalDays;
  const tax = subtotal * 0.1; // 10% tax
  const total = subtotal + tax;
  
  // Update summary
  document.getElementById("summaryRentalPeriod").textContent = `${rentalDays} days`;
  document.getElementById("summarySubtotal").textContent = `$${subtotal}`;
  document.getElementById("summaryTax").textContent = `$${tax.toFixed(2)}`;
  document.getElementById("summaryTotal").textContent = `$${total.toFixed(2)}`;
  
  // Update booking data
  bookingData.pickupDate = document.getElementById("pickupDate").value;
  bookingData.returnDate = document.getElementById("returnDate").value;
  bookingData.rentalDays = rentalDays;
  bookingData.subtotal = subtotal;
  bookingData.tax = tax;
  bookingData.totalPrice = total;
}

function proceedToPayment() {
  // Validate form
  const pickupDate = document.getElementById("pickupDate").value;
  const returnDate = document.getElementById("returnDate").value;
  const pickupLocation = document.getElementById("pickupLocation").value;
  
  if (!pickupDate || !returnDate || !pickupLocation) {
    alert("Please fill in all required fields.");
    return;
  }
  
  if (new Date(returnDate) <= new Date(pickupDate)) {
    alert("Return date must be after pickup date.");
    return;
  }
  
  // Update booking data
  bookingData.pickupLocation = pickupLocation;
  bookingData.specialRequests = document.getElementById("specialRequests").value;
  
  // Show payment section
  document.getElementById("bookingDetails").style.display = "none";
  document.getElementById("paymentSection").style.display = "grid";
  
  // Update steps
  document.getElementById("step1").classList.remove("active");
  document.getElementById("step2").classList.add("active");
  
  // Update payment summary
  const paymentSummary = document.getElementById("paymentSummary");
  paymentSummary.innerHTML = `
    <div class="car-detail">
      <div class="car-image">
        <img src="${bookingData.car.image}" alt="${bookingData.car.name}">
      </div>
      <div class="car-info">
        <h4>${bookingData.car.name}</h4>
        <p>${bookingData.car.specs.join(" | ")}</p>
      </div>
    </div>
    <div class="booking-details">
      <div class="detail-item">
        <span>Pickup Date:</span>
        <span>${bookingData.pickupDate}</span>
      </div>
      <div class="detail-item">
        <span>Return Date:</span>
        <span>${bookingData.returnDate}</span>
      </div>
      <div class="detail-item">
        <span>Pickup Location:</span>
        <span>${document.getElementById("pickupLocation").options[document.getElementById("pickupLocation").selectedIndex].text}</span>
      </div>
      <div class="detail-item">
        <span>Rental Period:</span>
        <span>${bookingData.rentalDays} days</span>
      </div>
      <div class="detail-item">
        <span>Subtotal:</span>
        <span>$${bookingData.subtotal}</span>
      </div>
      <div class="detail-item">
        <span>Tax (10%):</span>
        <span>$${bookingData.tax.toFixed(2)}</span>
      </div>
      <div class="detail-item total">
        <span>Total:</span>
        <span>$${bookingData.totalPrice.toFixed(2)}</span>
      </div>
    </div>
  `;
}

function backToBooking() {
  document.getElementById("paymentSection").style.display = "none";
  document.getElementById("bookingDetails").style.display = "grid";
  
  document.getElementById("step2").classList.remove("active");
  document.getElementById("step1").classList.add("active");
}

function processPayment() {
  // Simple validation
  const cardNumber = document.getElementById("cardNumber").value;
  const expiryDate = document.getElementById("expiryDate").value;
  const cvv = document.getElementById("cvv").value;
  const cardName = document.getElementById("cardName").value;
  
  if (!cardNumber || !expiryDate || !cvv || !cardName) {
    alert("Please fill in all payment details.");
    return;
  }
  
  // In a real application, you would process the payment here
  // For this demo, we'll just simulate a successful payment
  
  // Create a booking reference
  const bookingReference = "LW-" + Math.floor(100000 + Math.random() * 900000);
  
  // Save rental to localStorage
  const currentUser = JSON.parse(localStorage.getItem('currentUser'));
  const rentals = JSON.parse(localStorage.getItem('rentals')) || [];
  
  const newRental = {
    id: Date.now(),
    userId: currentUser.id,
    userName: currentUser.name,
    carId: bookingData.car.id,
    carName: bookingData.car.name,
    startDate: bookingData.pickupDate,
    endDate: bookingData.returnDate,
    pickupLocation: bookingData.pickupLocation,
    specialRequests: bookingData.specialRequests,
    totalPrice: bookingData.totalPrice,
    status: "Active",
    bookingReference: bookingReference
  };
  
  rentals.push(newRental);
  localStorage.setItem('rentals', JSON.stringify(rentals));
  
  // Update car availability
  const cars = JSON.parse(localStorage.getItem('cars')) || [];
  const carIndex = cars.findIndex(c => c.id === bookingData.car.id);
  if (carIndex !== -1) {
    cars[carIndex].available = false;
    localStorage.setItem('cars', JSON.stringify(cars));
  }
  
  // Show confirmation
  document.getElementById("paymentSection").style.display = "none";
  document.getElementById("confirmationSection").style.display = "block";
  document.getElementById("bookingReference").textContent = bookingReference;
  
  // Update steps
  document.getElementById("step2").classList.remove("active");
  document.getElementById("step3").classList.add("active", "completed");
  
  // Clear selected car from session storage
  sessionStorage.removeItem('selectedCar');
}
</script>
</body>
</html>